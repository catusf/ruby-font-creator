#!/usr/bin/env bash
# DESCRIPTION
#   Declare project variable to be used by other scripts
#
#   Launch Inkscape with minimal fonts to speed up batch processing. For that,
#   we use special $XDG_*_HOME setup and fontconfig $PATH
#
# USAGE
#   Other script need to include this file:
#     . envrc
#
# @author: Ã‰douard Lopez <dev+project@edouard-lopez.com>

scriptDir="$(dirname "$0")" # emplacement du script
appDir="$(cd "${scriptDir%/*}" && cd .. && pwd )"
resourcesDir="$appDir/resources"

# Fake a X server, to contains Inkscape
Xvfb :8 -screen 0 1024x768x8 &> /dev/null &
XVFB_PID=$!
echo $XVFB_PID > ./xvfb.pid
export DISPLAY=":8"


# Saxon
HPF_SAXON_DIR="$resourcesDir/saxon"
HPF_SAXON_JAR="$HPF_SAXON_DIR/saxon9he.jar"

# XSLT
HPF_XSLT_DIR="$resourcesDir/xslt"
HPF_XSLT_CSV2SVG="$HPF_XSLT_DIR/csv2svg.xsl"

# FONTS
HPF_FONT_DIR="$resourcesDir/fonts"

# Unihan Resources
HPF_UNIHAN_DIR="$resourcesDir/unihan"
HPF_UNIHAN_READING="$HPF_UNIHAN_DIR/Unihan_Readings.txt"

# Templates
HPF_TPL_DIR="$resourcesDir/tpl"
HPF_TPL_SVGTEXT="$resourcesDir/tpl/svg.text-x###.tpl.svg"
HPF_TPL_SVGPATH="$resourcesDir/tpl/svg.path-x###.tpl.svg"

# SVG
HPF_SVG_DIR="$resourcesDir/svg"
HPF_SVGTEXT_DIR="${HPF_SVG_DIR}-text"
HPF_SVGFONT_DIR="${HPF_SVG_DIR}-font"

# TMP
HPF_TMP_DIR="$appDir/.tmp"
HPF_UNIHAN_READING_SHORT="$HPF_TMP_DIR/unicode-pinyin.csv"

# INKSCAPE OPTIMIZATION
HPF_MINIMAL_XDG="${appDir}/local"
# env
export XDG_CONFIG_HOME="${HPF_MINIMAL_XDG}/config"
export XDG_CACHE_HOME="${HPF_MINIMAL_XDG}/cache"
export XDG_DATA_HOME="${HPF_MINIMAL_XDG}/share"
# export GTK2_RC_FILES="${HPF_MINIMAL_XDG}/config/gtk-2.0/gtkrc"
# fonts
export FONTCONFIG_PATH="${HPF_MINIMAL_XDG}/config/fontconfig"
export FONTCONFIG_FILE="${HPF_MINIMAL_XDG}/config/fontconfig/fonts.conf"
